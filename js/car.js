"use strict";var login=localStorage.getItem("login");function render(n){var e,t,a;localStorage.setItem("carCount",n.length),n.length?(e=n.every(function(n){return 1==n.is_select}),t=shopNum(n),a='<div class="panel panel-default">\n        <div class="panel-heading">\n            <div class="content">\n                <label for="" class="checkbox">\n                    <input type="checkbox" id="all" '+(e?"checked":"")+'>\n                    <span>全选</span>\n                </label>\n                <label for="" class="type">\n                    <span>商品种类：</span>\n                    <span>'+n.length+'</span>\n                </label>\n                <label for="" class="qty">\n                    <span>已选商品：</span>\n                    <span style="color:red">'+t.totalNum+'</span>件\n                </label>\n                <label for="" class="price">\n                    <span>总额：</span>\n                    <span>'+t.totalPrice+'</span>\n                </label>\n                <label for="" class="jie">\n                    <button class="btn btn-warning btn-xs jiesuan">结算</button>\n                    <button class="btn btn-info btn-xs qingkong">清空购物车</button>\n                </label>\n            </div>\n        </div>',a+='<div class="panel-body"><ul>',n.forEach(function(n){a+=' <li>\n                <div class="media">\n                    <div class="media-left media-middle">\n                        <input type="checkbox" class="check" '+(1==n.is_select?"checked":"")+' goods_id="'+n.uid+'">\n                        <a href="#">\n                            <img class="media-object"\n                                src="'+n.pic+'"\n                                alt="" style="width:100px;height:100px">\n                        </a>\n                    </div>\n                    <div class="media-body">\n                        <h4 class="media-heading">'+n.name+'</h4>\n                        <div class="price">\n                            <i class="glyphicon glyphicon-yen"></i>\n                            <span>'+n.price+'</span>\n                        </div>\n                        <div class="btn">\n                            <p>\n                                <butto class="btn btn-danger del" goods_id="'+n.uid+'">删除商品</butto>\n                            </p>\n                            <div class="btn-group" goods_id="'+n.uid+'" role="group" aria-label="...">\n                                <button class="btn btn-default reduce">-</button>\n                                <button class="btn btn-default">'+n.buyNum+'</button>\n                                <button class="btn btn-default add">+</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </li>'}),a+=" </ul></div></div> ",$(".shoppingCar").html(a)):$(".shoppingCar").html('<figure>\n        <img src="../images/carkong.png" alt="">\n        <figcaption>\n            <p>您的购物车没有商品</p>\n            <p>去看看我的收藏 或者去看看 <a href="../index.html" role="button">首页</a>\n        </figcaption>\n    </figure>')}function shopNum(n){n=n.filter(function(n){return 1==n.is_select});return{totalNum:n.reduce(function(n,e){return n+ +e.buyNum},0),totalPrice:n.reduce(function(n,e){return n+e.price*e.buyNum},0)}}login||(location.href="../html/zhuce.html",localStorage.setItem("url","../html/car.html")),$.ajax({url:"../api/getCarData.php",method:"get",data:{username:login},dataType:"json",async:!0,success:function(n){localStorage.setItem("shihuo",JSON.stringify(n)),render(n)},error:function(n){console.log(n)}}),$(".shoppingCar").on("click","#all",function(){var e=this,n=JSON.parse(localStorage.getItem("shihuo"));n.forEach(function(n){e.checked?n.is_select=1:n.is_select=0}),localStorage.setItem("shihuo",JSON.stringify(n)),render(n)}),$(".shoppingCar").on("click",".check",function(){var e=this,t=$(this).attr("goods_id"),n=JSON.parse(localStorage.getItem("shihuo"));n.forEach(function(n){n.uid==t&&(n.is_select=e.checked?1:0)}),localStorage.setItem("shihuo",JSON.stringify(n)),render(n)}),$(".shoppingCar").on("click",".del",function(){var e=$(this).attr("goods_id");$.ajax({url:"../api/removeCarData.php",method:"get",data:{username:login,uid:e},dataType:"json",async:!0,success:function(n){console.log(n),n.code&&(n=JSON.parse(localStorage.getItem("shihuo")).filter(function(n){return n.uid!=e}),localStorage.setItem("shihuo",JSON.stringify(n)),render(n))},error:function(n){console.log(n)}})}),$(".shoppingCar").on("click",".reduce",function(){var e=JSON.parse(localStorage.getItem("shihuo")),t=$(this).parent().attr("goods_id"),a=e.filter(function(n){return n.uid==t})[0],o=+a.buyNum;o<=1?o=1:o--,$.ajax({url:"../api/updCarData.php",method:"get",data:{username:login,uid:t,goods_num:o},dataType:"json",async:!0,success:function(n){console.log(n),n.code&&(a.buyNum=o,localStorage.setItem("shihuo",JSON.stringify(e)),render(e))},error:function(n){console.log(n)}})}),$(".shoppingCar").on("click",".add",function(){var e=JSON.parse(localStorage.getItem("shihuo")),t=$(this).parent().attr("goods_id"),a=e.filter(function(n){return n.uid==t})[0],o=+a.buyNum;o++,$.ajax({url:"../api/updCarData.php",method:"get",data:{username:login,uid:t,goods_num:o},dataType:"json",async:!0,success:function(n){console.log(n),n.code&&(a.buyNum=o,localStorage.setItem("shihuo",JSON.stringify(e)),render(e))},error:function(n){console.log(n)}})}),$(".shoppingCar").on("click",".jiesuan",function(){var n=JSON.parse(localStorage.getItem("shihuo")),e=n.filter(function(n){return 0==n.is_select});n.forEach(function(n){1==n.is_select&&$.ajax({url:"../api/removeCarData.php",method:"get",data:{username:login,uid:n.uid},dataType:"json",async:!0,success:function(n){console.log(n)},error:function(n){console.log(n)}})}),render(e)}),$(".shoppingCar").on("click",".qingkong",function(){$.ajax({url:"../api/clearCarData.php",method:"get",data:{username:login},dataType:"json",async:!0,success:function(n){console.log(n),n.code&&(localStorage.removeItem("shihuo"),render(n))},error:function(n){console.log(n)}})});